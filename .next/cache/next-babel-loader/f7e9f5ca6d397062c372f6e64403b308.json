{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport fetch from 'isomorphic-unfetch';\nexport default (function _callee(query) {\n  var cached, res, json;\n  return _regeneratorRuntime.async(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          if (query.trim()) {\n            _context.next = 2;\n            break;\n          }\n\n          return _context.abrupt(\"return\", null);\n\n        case 2:\n          cached = true && window.localStorage.getItem(\"cache:\".concat(encodeURIComponent(query)));\n\n          if (!cached) {\n            _context.next = 5;\n            break;\n          }\n\n          return _context.abrupt(\"return\", JSON.parse(cached));\n\n        case 5:\n          _context.next = 7;\n          return _regeneratorRuntime.awrap(fetch(\"/api/search/\".concat(encodeURIComponent(query))));\n\n        case 7:\n          res = _context.sent;\n\n          if (!res.ok) {\n            _context.next = 16;\n            break;\n          }\n\n          _context.next = 11;\n          return _regeneratorRuntime.awrap(res.json());\n\n        case 11:\n          json = _context.sent;\n          true && window.localStorage.setItem(\"cache:\".concat(encodeURIComponent(query)), _JSON$stringify(json));\n          return _context.abrupt(\"return\", json);\n\n        case 16:\n          _context.t0 = Error;\n          _context.next = 19;\n          return _regeneratorRuntime.awrap(res.text());\n\n        case 19:\n          _context.t1 = _context.sent;\n          throw new _context.t0(_context.t1);\n\n        case 21:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  });\n});","map":{"version":3,"sources":["/home/runner/vidregator-1/lib/apiSearch.js"],"names":["fetch","query","trim","cached","window","localStorage","getItem","encodeURIComponent","JSON","parse","res","ok","json","setItem","Error","text"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,oBAAlB;AAEA,gBAAe,iBAAOC,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cACRA,KAAK,CAACC,IAAN,EADQ;AAAA;AAAA;AAAA;;AAAA,2CACa,IADb;;AAAA;AAGPC,UAAAA,MAHO,GAGE,QAA8BC,MAAM,CAACC,YAAP,CAAoBC,OAApB,iBAAqCC,kBAAkB,CAACN,KAAD,CAAvD,EAHhC;;AAAA,eAITE,MAJS;AAAA;AAAA;AAAA;;AAAA,2CAIMK,IAAI,CAACC,KAAL,CAAWN,MAAX,CAJN;;AAAA;AAAA;AAAA,2CAMKH,KAAK,uBAAgBO,kBAAkB,CAACN,KAAD,CAAlC,EANV;;AAAA;AAMPS,UAAAA,GANO;;AAAA,eAOTA,GAAG,CAACC,EAPK;AAAA;AAAA;AAAA;;AAAA;AAAA,2CAQQD,GAAG,CAACE,IAAJ,EARR;;AAAA;AAQLA,UAAAA,IARK;AASX,kBAA8BR,MAAM,CAACC,YAAP,CAAoBQ,OAApB,iBAAqCN,kBAAkB,CAACN,KAAD,CAAvD,GAAkE,gBAAeW,IAAf,CAAlE,CAA9B;AATW,2CAUJA,IAVI;;AAAA;AAAA,wBAYDE,KAZC;AAAA;AAAA,2CAYWJ,GAAG,CAACK,IAAJ,EAZX;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAf","sourcesContent":["import fetch from 'isomorphic-unfetch'\n\nexport default async (query) => {\n  if (!query.trim()) return null\n\n  const cached = typeof window === 'object' && window.localStorage.getItem(`cache:${encodeURIComponent(query)}`)\n  if (cached) return JSON.parse(cached)\n\n  const res = await fetch(`/api/search/${encodeURIComponent(query)}`)\n  if (res.ok) {\n    const json = await res.json()\n    typeof window === 'object' && window.localStorage.setItem(`cache:${encodeURIComponent(query)}`, JSON.stringify(json))\n    return json\n  } else {\n    throw new Error(await res.text())\n  }\n}"]},"metadata":{},"sourceType":"module"}